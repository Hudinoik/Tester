<!DOCTYPE html><html lang='en'><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'><title>Admin / Superadmin</title><link rel='stylesheet' href='style.css'></head><body><header><h1>Admin</h1><nav><a href='index.html'>Directory</a></nav></header><div class='container'><div class='card'><h3>Authenticate</h3><div class='grid grid-cols-2'><input id='a_email' placeholder='email'><input id='a_password' type='password' placeholder='password'></div><button onclick='login()'>Login</button><div id='who' class='muted small'></div></div><div class='grid grid-cols-2'><div class='card'><h3>Managers & Admins</h3><div id='users-box'></div><h4>Create User</h4><div class='grid grid-cols-2'><input id='u_email' placeholder='user email'><input id='u_password' type='password' placeholder='temp password'></div><div class='grid grid-cols-2'><select id='u_role'><option>manager</option><option>admin</option><option>superadmin</option></select><input id='u_shulId' type='number' placeholder='Shul ID (for manager)'></div><button onclick='createUser()'>Create</button></div><div class='card'><h3>Add / Edit Shul</h3><label>Name</label><input id='s_name'><label>Address</label><div class='autocomplete'><input id='s_address'><div id='s_ac' class='ac-results' style='display:none'></div></div><label>Area</label><input id='s_area'><button onclick='addShul()'>Add Shul</button><div class='muted small'>Existing shuls are preloaded. Use the table below to find IDs to assign managers.</div></div></div><div class='card'><h3>All Shuls</h3><div id='shuls-box'></div></div></div><script src='autocomplete.js'></script><script>let token=null,role=null;async function login(){const email=document.getElementById('a_email').value;const password=document.getElementById('a_password').value;const res=await fetch('/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});const data=await res.json();if(data.token){token=data.token;role=data.role;document.getElementById('who').textContent=`Logged in as ${role}`;if(role!=='superadmin'){alert('Only superadmin can manage users.');}loadUsers();loadShuls();}else alert(data.error||'Login failed');}async function loadUsers(){if(!token)return;const res=await fetch('/users',{headers:{'Authorization':'Bearer '+token}});if(!res.ok)return;const users=await res.json();const rows=users.map(u=>`<tr><td>${u.id}</td><td>${u.email}</td><td>${u.role}</td><td>${u.shulId||''}</td><td>${u.shulName||''}</td><td><button class='btn-secondary' onclick='promote(${u.id},"admin")'>Make Admin</button><button class='btn-secondary' onclick='assign(${u.id})'>Assign Shul</button><button class='btn-secondary' onclick='reset(${u.id})'>Reset PW</button><button onclick='delUser(${u.id})'>Delete</button></td></tr>`).join('');document.getElementById('users-box').innerHTML=`<table class='table'><thead><tr><th>ID</th><th>Email</th><th>Role</th><th>Shul ID</th><th>Shul</th><th></th></tr></thead><tbody>${rows}</tbody></table>`;}async function promote(id,roleNew){if(!token)return;const res=await fetch(`/users/${id}`,{method:'PUT',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({role:roleNew})});if(res.ok){loadUsers();}else alert('Failed');}async function assign(id){const shulId=prompt('Shul ID to assign:');if(!shulId)return;const res=await fetch(`/users/${id}`,{method:'PUT',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({shulId:parseInt(shulId,10)})});if(res.ok){loadUsers();}else alert('Failed');}async function reset(id){const pw=prompt('New temporary password:');if(!pw)return;const res=await fetch(`/users/${id}`,{method:'PUT',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({password:pw})});if(res.ok){alert('Password updated.');}else alert('Failed');}async function delUser(id){if(!confirm('Delete this user?'))return;const res=await fetch(`/users/${id}`,{method:'DELETE',headers:{'Authorization':'Bearer '+token}});if(res.ok){loadUsers();}else alert('Failed');}async function createUser(){if(!token)return alert('Login first');const body={email:document.getElementById('u_email').value.trim(),password:document.getElementById('u_password').value.trim(),role:document.getElementById('u_role').value,shulId:parseInt(document.getElementById('u_shulId').value||'0',10)||null};const res=await fetch('/users',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify(body)});if(res.ok){alert('User created');loadUsers();}else{const j=await res.json().catch(()=>({}));alert(j.error||'Failed');}}async function addShul(){if(!token)return alert('Login first');const body={name:document.getElementById('s_name').value.trim(),address:document.getElementById('s_address').value.trim(),area:document.getElementById('s_area').value.trim()};const res=await fetch('/shuls',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify(body)});const j=await res.json();if(res.ok){alert('Shul created with ID '+j.id);loadShuls();}else alert(j.error||'Failed');}async function loadShuls(){const res=await fetch('/shuls');const data=await res.json();const rows=data.map(s=>`<tr><td>${s.id}</td><td>${s.name}</td><td>${s.address||''}</td></tr>`).join('');document.getElementById('shuls-box').innerHTML=`<table class='table'><thead><tr><th>ID</th><th>Name</th><th>Address</th></tr></thead><tbody>${rows}</tbody></table>`;}attachAutocomplete('s_address','s_ac');</script></body></html>