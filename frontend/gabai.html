<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gabai – Minyanim SA</title>
<link rel="stylesheet" href="style.css"></head><body>
<header><div class="brand"><div class="logo"></div><h1>Minyanim SA – Gabai</h1></div><nav><a href="index.html">Public</a><a href="admin.html">Admin</a></nav></header>
<div class="container" style="max-width:760px">
  <div class="card"><h3>Pick Shul</h3><select id="shulSel" onchange="loadCurrent()"></select></div>

  <div class="card">
    <h3>Minyan Times</h3>
    <div id="minyan-list"></div>
    <div class="grid grid-2">
      <select id="m_type">
        <option>Shacharis</option><option>Mincha</option><option>Maariv</option><option>Mincha–Maariv (Back-to-back)</option><option>Other</option>
        <option>Shabbos – Candle Lighting</option>
        <option>Shabbos – Mincha (Erev)</option>
        <option>Shabbos – Kabbalat Shabbat</option>
        <option>Shabbos – Shacharis</option>
        <option>Shabbos – Mincha (Day)</option>
        <option>Shabbos – Maariv (Motzei)</option>
        <option>Shabbos – Havdalah</option>
        <option>Shabbos – Other</option>
      </select>
      <input id="m_time" class="time-input" placeholder="HH:MM">
    </div>
    <input id="m_note" placeholder="Note (optional)">
    <div class="row" style="margin-top:8px"><button onclick="addMinyan()">Add Minyan</button></div>
    <div class="row" style="margin-top:8px"><button class="btn-ghost" onclick="saveTimes()">Save All Times</button></div>
  </div>
</div>
<script src="utils.js"></script>
<script>
let token, shuls=[], current=null, minyanItems=[];
async function init(){
  token=localStorage.getItem('token'); if(!token){location.href='login.html';return;}
  const r=await fetch('/my-shuls',{headers:{Authorization:'Bearer '+token}}); shuls=await r.json();
  document.getElementById('shulSel').innerHTML=shuls.map(s=>`<option value="${s.id}">${s.name}</option>`).join('');
  enableTimePicker(); loadCurrent();
}
async function loadCurrent(){
  const id=parseInt(document.getElementById('shulSel').value,10);
  const r=await fetch('/shuls/'+id+'/full'); current=await r.json();
  minyanItems=(current.minyanim||[]).map(m=>({type:m.type,time:m.time,note:m.note||''}));
  renderTimes();
}
function renderTimes(){
  const box=document.getElementById('minyan-list');
  if(!minyanItems.length){ box.innerHTML='<p class="muted small">No minyanim yet.</p>'; return; }
  box.innerHTML = `<table class='table'><thead><tr><th>Type</th><th>Time</th><th>Note</th><th></th></tr></thead><tbody>`+
    minyanItems.map((m,i)=>`<tr><td>${m.type}</td><td>${m.time}</td><td>${m.note||''}</td><td><button class='btn-ghost' onclick='rem(${i})'>Remove</button></td></tr>`).join('')+
    `</tbody></table>`;
}
function addMinyan(){ const t=document.getElementById('m_type').value; const tm=document.getElementById('m_time').value; const n=document.getElementById('m_note').value.trim(); if(!tm) return alert('Pick a time'); minyanItems.push({type:t,time:tm,note:n}); document.getElementById('m_time').value=''; document.getElementById('m_note').value=''; renderTimes(); }
function rem(i){ minyanItems.splice(i,1); renderTimes(); }
async function saveTimes(){
  const r=await fetch('/shuls/'+current.id+'/minyanim',{method:'PUT',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify(minyanItems)});
  if(!r.ok){ const j=await r.json().catch(()=>({})); return alert(j.error||'Failed saving times'); }
  alert('Saved! Open the home page to see your times.');
}
init();
</script>
</body></html>
