<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Manage My Shul</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main class="narrow">
    <h2>Manage My Shul</h2>
    <div id="who" class="muted"></div>
    <label>Name</label>
    <input id="name">
    <label>Address</label>
    <input id="address">
    <label>Minyanim (one per line)</label>
    <textarea id="minyanim" rows="8" placeholder="Shacharis: 6:30&#10;Mincha: 13:15&#10;Maariv: 19:00"></textarea>
    <button onclick="save()">Save</button>
    <p class="muted"><a href="index.html">← Back to directory</a></p>
  </main>

  <script>
    let token, shulId, role;

    async function init(){
      token = localStorage.getItem("token");
      shulId = parseInt(localStorage.getItem("shulId") || "0", 10);
      role = localStorage.getItem("role");
      if(!token || !shulId){
        alert("Please login first.");
        location.href = "login.html";
        return;
      }
      document.getElementById("who").textContent = `Logged in as ${role}. Editing Shul ID ${shulId}`;
      const res = await fetch("/shuls");
      const all = await res.json();
      const mine = all.find(s => s.id === shulId);
      if(!mine){ alert("Your shul was not found yet. Ask admin to create it."); return; }
      document.getElementById("name").value = mine.name;
      document.getElementById("address").value = mine.address;
      document.getElementById("minyanim").value = mine.minyanim;
    }

    async function save(){
      const body = {
        name: document.getElementById("name").value.trim(),
        address: document.getElementById("address").value.trim(),
        minyanim: document.getElementById("minyanim").value.trim()
      };
      const res = await fetch(`/shuls/${shulId}`, {
        method: "PUT",
        headers: { "Content-Type":"application/json", "Authorization": "Bearer " + token },
        body: JSON.stringify(body)
      });
      if(res.ok){ alert("Saved!"); }
      else {
        const j = await res.json().catch(()=>({}));
        alert(j.error || "Save failed");
      }
    }

    init();
  </script>
</body>
</html>
