<!DOCTYPE html><html lang='en'><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'><title>Manage My Shul</title><link rel='stylesheet' href='style.css'></head><body><header><h1>Manage My Shul</h1><nav><a href='index.html'>Directory</a><a href='admin.html'>Admin</a></nav></header><div class='container' style='max-width:720px'><div class='card'><h3>Shul Details</h3><label>Name</label><input id='name'><label>Address</label><div class='autocomplete'><input id='address'><div id='ac' class='ac-results' style='display:none'></div></div><label>Area (optional)</label><input id='area'></div><div class='card'><h3>Minyan Times</h3><div id='minyan-list'></div><div class='grid grid-cols-2'><select id='m_type'><option>Shacharis</option><option>Mincha</option><option>Maariv</option><option>Other</option></select><input id='m_time' placeholder='e.g. 06:15 or Sun-Thu 18:00'></div><input id='m_note' placeholder='Note (optional)'><button onclick='addMinyan()'>Add Minyan</button></div><div class='card'><button onclick='saveAll()'>Save All</button></div></div><script src='autocomplete.js'></script><script>let token,shulId,role,allShuls=[],myShul=null,minyanItems=[];async function init(){token=localStorage.getItem('token');shulId=parseInt(localStorage.getItem('shulId')||'0',10);role=localStorage.getItem('role');if(!token||!shulId){alert('Please login as a manager.');location.href='login.html';return;}attachAutocomplete('address','ac');const res=await fetch('/shuls');allShuls=await res.json();myShul=allShuls.find(s=>s.id===shulId);if(!myShul){alert('Ask admin to assign your shul.');return;}document.getElementById('name').value=myShul.name||'';document.getElementById('address').value=myShul.address||'';document.getElementById('area').value=myShul.area||'';minyanItems=(myShul.minyanim||[]).map(m=>({type:m.type,time:m.time,note:m.note||''}));renderMinyan();}function renderMinyan(){const box=document.getElementById('minyan-list');if(!minyanItems.length){box.innerHTML='<p class="muted small">No minyanim yet.</p>';return;}box.innerHTML=`<table class='table'><thead><tr><th>Type</th><th>Time</th><th>Note</th><th></th></tr></thead><tbody>`+minyanItems.map((m,i)=>`<tr><td>${m.type}</td><td>${m.time}</td><td>${m.note||''}</td><td><button class='btn-secondary' onclick='removeMin(${i})'>Remove</button></td></tr>`).join('')+`</tbody></table>`;}function addMinyan(){const type=document.getElementById('m_type').value;const time=document.getElementById('m_time').value.trim();const note=document.getElementById('m_note').value.trim();if(!time)return alert('Enter a time.');minyanItems.push({type,time,note});document.getElementById('m_time').value='';document.getElementById('m_note').value='';renderMinyan();}function removeMin(i){minyanItems.splice(i,1);renderMinyan();}async function saveAll(){const bodyShul={name:document.getElementById('name').value.trim(),address:document.getElementById('address').value.trim(),area:document.getElementById('area').value.trim()};let r1=await fetch(`/shuls/${shulId}`,{method:'PUT',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify(bodyShul)});if(!r1.ok){const j=await r1.json().catch(()=>({}));return alert(j.error||'Failed saving shul');}let r2=await fetch(`/shuls/${shulId}/minyanim`,{method:'PUT',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify(minyanItems)});if(!r2.ok){const j=await r2.json().catch(()=>({}));return alert(j.error||'Failed saving minyanim');}alert('Saved!');}init();</script></body></html>