async function attachAutocomplete(inputId,resultsId){const i=document.getElementById(inputId);const rs=document.getElementById(resultsId);let t=null;i.addEventListener("input",()=>{clearTimeout(t);const q=i.value.trim();if(!q){rs.innerHTML="";rs.style.display="none";return;}t=setTimeout(async()=>{try{const r=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}&limit=6`);const d=await r.json();rs.innerHTML=d.map(v=>`<div class="ac-item" data-v="${v.display_name}">${v.display_name}</div>`).join("");rs.style.display=d.length?"block":"none";}catch(e){rs.innerHTML="";rs.style.display="none";}},300);});rs.addEventListener("click",e=>{const el=e.target.closest(".ac-item");if(!el)return;i.value=el.getAttribute("data-v");rs.innerHTML="";rs.style.display="none";});}
function haversine(a,b,c,d){function r(x){return x*Math.PI/180}if([a,b,c,d].some(v=>v==null||isNaN(v)))return Infinity;const R=6371;const dLat=r(c-a),dLon=r(d-b);const q=Math.sin(dLat/2)**2+Math.cos(r(a))*Math.cos(r(c))*Math.sin(dLon/2)**2;return R*2*Math.atan2(Math.sqrt(q),Math.sqrt(1-q));}
function copyText(s){navigator.clipboard?.writeText(s).then(()=>alert("Copied"));}function mapLink(s){if(s.lat&&s.lon)return `https://www.google.com/maps?q=${s.lat},${s.lon}`;return `https://www.google.com/maps?q=${encodeURIComponent(s.address||s.name)}`;}
function favs(){return JSON.parse(localStorage.getItem("favs")||"[]")}function toggleFav(id){let f=favs();if(f.includes(id))f=f.filter(x=>x!==id);else f.push(id);localStorage.setItem("favs",JSON.stringify(f));}function isFav(id){return favs().includes(id);}